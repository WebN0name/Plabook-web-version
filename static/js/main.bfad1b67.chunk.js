(this["webpackJsonpplabook-web-version"]=this["webpackJsonpplabook-web-version"]||[]).push([[0],{10:function(e,t,r){},24:function(e,t,r){e.exports=r.p+"static/media/Bird.5c5bb4c1.png"},27:function(e,t,r){e.exports=r(54)},32:function(e,t,r){},54:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),c=r(20),o=r.n(c),s=(r(32),r(10),r(7)),i=r.n(s),l=r(21),u=r(22),d=r(23),m=r(26),h=r(25),g=r(4),f=r.n(g),p=r(24),v=r.n(p),k=r(3),w=r(5),_=function(e){Object(m.a)(r,e);var t=Object(h.a)(r);function r(e){var a;return Object(u.a)(this,r),(a=t.call(this,e))._loop=function(){window.requestAnimationFrame(a._loop),a.analizer.getByteFrequencyData(a.frequency),a.setState({checkVoice:a.frequency[0]})},a._setCheckVoice=function(e){return a.state.isRecord&&e>30?{borderColor:"green",color:"green"}:{borderColor:"black",color:"black"}},a._getWordsArray=function(e){e=e.split(" ");for(var t=[],r=0,n=0;n<e.length;n++){var c={id:r,word:e[n],style:"default"};if(t.push(c),r++,n!==e.length-1){var o={id:r,word:" ",style:"default"};t.push(o),r++}}a.state.texts.push(t)},a._setBackground=function(e){return{backgroundImage:e="url(data:image/jpeg;base64,"+e+")"}},a._clickArrowRight=function(){if(a.state.currentId<a.state.names.length-1){var e=a.state.currentId,t=a.state.percents;t+=25,e++,a.setState({currentName:a.state.names[e],currentText:a.state.texts[e],currentImage:a.state.images[e],currentId:e,percents:t})}},a._clickArrowLeft=function(){if(a.state.currentId>0){var e=a.state.currentId,t=a.state.percents;t-=25,e--,a.setState({currentName:a.state.names[e],currentText:a.state.texts[e],currentImage:a.state.images[e],currentId:e,percents:t})}},a._countPercents=function(e){var t=String(e);return t+="%"},a._countWidth=function(e){var t=String(e);return{width:t+="%"}},a._stopRecord=Object(l.a)(i.a.mark((function e(){var t,r,n,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.Recorder.stop(),e.next=3,a._getResult();case 3:return t=e.sent,(r=[]).push(t),n=new Blob(r,{type:"audio/wav"}),e.next=9,a._getBinaryString(n);case 9:c=e.sent,console.log(a.state.currentName),f.a.post("http://95.163.215.127:3000/saveRecord",{textName:a.state.currentName,record:c}).then((function(e){var t=e.data.result._id;f.a.post("http://95.163.215.127:3000/checkRecord",{textName:a.state.currentName,recordId:t}).then((function(e){var t=e.data,r=0,n=a.state.currentText;console.log(t);for(var c=0;c<n.length;c++)" "!==n[c].word&&(0===t[r]?n[c].style="wrong":n[c].style="right",r++);console.log(n)}))}));case 12:case"end":return e.stop()}}),e)}))),a._getBinaryString=function(e){return new Promise((function(t,r){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=r,a.readAsDataURL(e)}))},a._getResult=function(){return new Promise((function(e){a.Recorder.ondataavailable=function(t){e(t.data)}}))},a._clickRecordButton=function(){!1===a.state.isRecord?(a.setState({isRecord:!0,microIcon:k.d}),a._startRecord()):(a.setState({isRecord:!1,microIcon:k.c}),a._stopRecord())},a._setAnswerColor=function(e){return"wrong"===e?{backgroundColor:"rgba(255, 0, 0, 0.7)",lineHeight:2,borderRadius:6}:"right"===e?{backgroundColor:"rgba(0, 128, 0, 0.7)",lineHeight:2,borderRadius:6}:"default"===e?{backgroundColor:"transparent",fontSize:36,lineHeight:2,borderRadius:6}:void 0},a._checkLeftArrow=function(e){if(e===a.state.names[0])return{visibility:"hidden"}},a._checkRightArrow=function(e){if(e===a.state.names[a.state.names.length-1])return{visibility:"hidden"}},a.Recorder=null,a.frequency=new Uint8Array(64),a.analizer=null,a.state={images:[],texts:[],names:[],currentImage:"",currentName:"",currentText:[],currentId:0,percents:0,microIcon:k.c,isRecord:!1,checkVoice:0},a}return Object(d.a)(r,[{key:"_getPermition",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.setState({isHavePermition:!0}),e.Recorder=new MediaRecorder(t);var r=new AudioContext;e.analizer=r.createAnalyser(),r.createMediaStreamSource(t).connect(e.analizer),e._loop()}))}},{key:"componentDidMount",value:function(){var e=this;this._getPermition(),f.a.get("http://95.163.215.127:3000/texts").then((function(t){for(var r=0;r<t.data.length;r++)e.state.images.push(t.data[r].image),e.state.names.push(t.data[r].name),e._getWordsArray(t.data[r].text);e.setState({currentImage:e.state.images[0],currentName:e.state.names[0],currentText:e.state.texts[0]})}))}},{key:"_startRecord",value:function(){this.Recorder.start()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"wrapper",style:this._setBackground(this.state.currentImage)},n.a.createElement("div",{className:"sidesWrapper"},n.a.createElement("div",{className:"leftSide"},n.a.createElement("p",{className:"textBlock"},this.state.currentText.map((function(t){return n.a.createElement("span",{key:t.id,style:e._setAnswerColor(t.style)},t.word)})))),n.a.createElement("div",{className:"rightSide"},n.a.createElement("img",{src:v.a}))),n.a.createElement("div",{className:"controlBlock"},n.a.createElement("div",{className:"pageControll"},n.a.createElement("div",{className:"progressBar"},n.a.createElement("div",{className:"progressInner",style:this._countWidth(this.state.percents)}),n.a.createElement("div",{className:"percents"},n.a.createElement("p",null,this._countPercents(this.state.percents)))),n.a.createElement("div",{className:"arrowsBlock"},n.a.createElement("a",{className:"controlBtn",href:"#",onClick:this._clickArrowLeft,style:this._checkLeftArrow(this.state.currentName)},n.a.createElement(w.a,{icon:k.a})),n.a.createElement("a",{className:"controlBtn",href:"#",onClick:this._clickRecordButton,style:this._setCheckVoice(this.state.checkVoice)},n.a.createElement(w.a,{icon:this.state.microIcon})),n.a.createElement("a",{className:"controlBtn",href:"#",onClick:this._clickArrowRight,style:this._checkRightArrow(this.state.currentName)},n.a.createElement(w.a,{icon:k.b}))))))}}]),r}(n.a.Component);var b=function(){return n.a.createElement("div",{className:"App"},n.a.createElement(_,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.bfad1b67.chunk.js.map